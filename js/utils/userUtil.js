"use strict";!function(e,t){if("undefined"!=typeof module)require("./ajaxUtil"),require("./nativeUtil"),require("../libs/stringUtil"),require("../libs/cache"),module.exports=t(e);else if(t(e),"function"==typeof define&&(define.amd||define.cmd)){var i="//"+(!/ppppoints.com/.test(document.domain)?"j.changyoyo.com":"j.ppppoints.com")+"/static/js/";requirejs.config({paths:{cache:i+"libs/cache",stringUtil:i+"libs/stringUtil",ajaxUtil:i+"utils/ajaxUtil",nativeUtil:i+"utils/nativeUtil"}}),define("userUtil",["cache","stringUtil","ajaxUtil","nativeUtil"],function(){return t(e)})}}(window||void 0,function(e){if(!e.CY&&(e.CY={}),e.CY.userUtil)return e.CY.userUtil;var t=function(e){return Object.prototype.toString.call(e).split(/\s(\w+)/)[1].toLowerCase()},i="login_token",n={data:{token:spm.util.cookie.get(i)||""},set:function(e){spm.util.cookie.get(i)!=e&&(this.data.token=e,spm.util.cookie.set(i,e))},get:function(){var e=this.data.token;return e||(e=spm.util.cookie.get(i))&&this.set(e),e},check_v1:function(t){var n,c,o,a,r=this;if(c="__cache_key",n=spm.util.cookie.get(i),t=t||function(){},a=function(){var e=t;return new Promise(function(i,n){t=function(t){e(t),i(t)}})},e.CY.cache.get(c)||!n)return n=e.CY.cache.get(c)||n||"",t(n),new Promise(function(e,t){e(n)});if(r.__callbacks){var l=a();return r.__callbacks.push(t),l}return r.__callbacks=[t],o=function(e){r.__callbacks.map(function(t){setTimeout(function(){t(e)},0)}),delete r.__callbacks},e.CY.ajaxUtil.loadData("/pointgate/service/validate/loginToken",{method:"POST",headers:{Accept:"application/json"},body:{login_token:n},credentials:"include"}).then(function(t){return t=t&&t.data||{},n="00"==t.validResult?n:"",r.set(n),o(n),n&&e.CY.cache.set(c,n,5e3),n})},checkLogin:function(i){i=i||{},"string"==t(i)&&(i={url:i}),"function"==t(i)&&(i={callback:i});var n,c,o,a,r=this;c=i.url,n="/login/getlogincode.htm",o=i.callback||function(){},a=function(e){!1!==o(e,c)&&c&&spm.refresh(c)},r.check_v1(function(t){if(t)return a(t);e.CY.nativeUtil.open_v1({action:"login",ios:{isVebView:!0},callback:function(e){r.set(e.token),a(e.token)}})||(c=e.CY.stringUtil.addQueryValue(n,"callback",encodeURIComponent(c||location.href)),a(t))})},checkLink:function(){var e=this,t=document,i=t.body;i.__isBind||(i.__isBind=!0,i.addEventListener("click",function(t){for(var n,c=t.target||t.srcElement,o=0;c&&c!=i;){if(1==c.nodeType){if(o++>6)return;if(/^(a|area)$/i.test(c.nodeName)&&(n=c.href||"",-1!=n.indexOf("needlogin=true")||c.getAttribute("needlogin")))return e.checkLogin(n),void t.preventDefault()}c=c.parentNode}}))}};return e.CY.userUtil=n,n});