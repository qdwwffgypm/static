!function(a,b){if("undefined"!=typeof module)require("../common/td"),require("../common/tfd"),require("../libs/valid"),require("../libs/dialog"),require("../utils/sendSmsUtil"),require("../utils/userUtil"),module.exports=b(a);else if(b(a),"function"==typeof define&&(define.amd||define.cmd)){var c="//"+(!/ppppoints.com/.test(document.domain)?"j.changyoyo.com":"j.ppppoints.com")+"/static/js/";requirejs.config({paths:{td:c+"common/td",tfd:c+"common/tfd",valid:c+"libs/valid",dialog:c+"libs/dialog",userUtil:c+"utils/userUtil",sendSmsUtil:c+"utils/sendSmsUtil"}}),define("otpModule",["td","tfd","valid","dialog","userUtil","sendSmsUtil"],function(){return b(a)})}}(window||this,function(a){var b,c,d,e,f,g,h,i;return!a.CY&&(a.CY={}),a.CY.otpModule?a.CY.otpModule:(b=document,c=function(a,b){return a&&a instanceof Object?a:a?(b||document).querySelector(a):null},d=function(a){return Object.prototype.toString.call(a).split(/\s(\w+)/)[1].toLowerCase()},e=function(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"!=d(b[c])?void 0!=b[c]&&(a[c]=b[c]):a[c]=e(a[c]||{},b[c]));return a},f="/butler/index.htm?type=cmcc&opt=exchange&query=true",h=function(a){return a+(Math.random()+"").slice(9)},i=function(){var i,a=[],d=[];return a.push('<div class="otpInner">'),a.push(' <div class="title"></div>'),a.push('	<form id="myForm">'),a.push('		<dl class="dl-item">'),a.push('			<dd class="dl-dd">'),a.push('				<input class="l-input" id="mobileid" name="mobileid" maxlength="11" type="tel"/>'),a.push("			</dd>"),a.push("		</dl>"),a.push('		<dl class="dl-item" >'),a.push('			<dd class="dl-dd">'),a.push('				<input class="l-input l-code-inp" id="smsCode" name="smsCode" maxlength="4"  type="tel"/><a class="l-input l-code-btn" id="codeBtn">获取验证码</a>'),a.push("			</dd>"),a.push("		</dl>"),a.push('		<dl class="dl-item">'),a.push('			<dd class="dl-dd">'),a.push('				<p class="text-xy">登录即表示同意畅由<a href="/register/agreement.htm">《用户使用协议》</a></p>'),a.push("			</dd>"),a.push("		</dl>"),a.push('		<dl class="dl-item">'),a.push('			<dd class="dl-dd" style="display: block;text-align: center;">'),a.push('				<input class="l-button" type="button" id="submitBtn" value="立即绑定">'),a.push("			</dd>"),a.push("		</dl>"),a.push("	</form>"),a.push("</div>"),a=a.join(""),d.push('<div class="otpInner">'),d.push('	<dl class="dl-success">'),d.push('		<dt><img id="imageUrl" src="/static/css/index/180206/f-photo-2@2x.png"/></dt>'),d.push('		<dd style="flex: 2;">'),d.push('			<p id="mobileNo">-----------</p>'),d.push('			<p>畅由积分：<span id="points">-</span></p>'),d.push("		</dd>"),d.push("		<dd>"),d.push('			<a class="lBtn btnPoint" href="'+f+'">获取更多积分</a>'),d.push('			<span class="lBtn btnLoginout">退出登录</span>'),d.push("		</dd>"),d.push("	</dl>"),d.push("</div>"),d=d.join(""),i=function(){var c,a=[];a.push(".otpModule {background-color: #efeff4;padding: 15px 5px;}"),a.push(".otpInner {background-color: #fff;padding: 10px 20px 10px 20px;border-radius: 6px;}"),a.push(".otpModule .dl-item{}"),a.push(".otpModule .dl-item .dl-dd{margin:0;padding:.2rem 0rem;display: flex;}"),a.push(".otpModule .sign{background-image:url(http://i0.beta.ule.com/i/my/2016/0504/zjl_icon_002.png);background-repeat:no-repeat;background-position:0 center;padding-left:12px}"),a.push(".otpModule .l-input{width:100%;color:#373636;padding:0 7px;display:inline-block;vertical-align:middle;background-color:#ece9e8;height:.8rem;line-height:.8rem;border-radius:.4rem;border:none;padding-left:.3rem;font-size:.3rem}"),a.push(".otpModule .l-input:focus{color:#000}"),a.push(".otpModule .gverify{height:.8rem;width: 1.74rem;}"),a.push(".otpModule .readonly{background-color:#ededed;cursor:default;color:#808080}"),a.push(".otpModule .l-code-inp{width: calc(100% - 1.94rem);margin-right:10px;}"),a.push(".otpModule .l-code-btn{padding: 0rem;position:relative;width: 1.74rem;text-align:center;background-color:#ece9e8;color:#ca3638;font-size:.26rem;}"),a.push(".otpModule .text-xy{color:#6d3826;font-size:.24rem;line-height:.3rem;padding-left:.4rem;background:url(/event/2018/activePlatform02/images/xy.png) 0 0 no-repeat;background-size:.3rem .3rem}"),a.push(".otpModule .text-xy a{color:#6d3826}"),a.push(".otpModule .l-button{display:inline-block;vertical-align:middle;text-align:center;width:4.68rem;font-size:.5rem;height:1rem;border:none;color:#fff;border-radius:.5rem;background:-webkit-gradient(linear,0 0,0 100%,from(#f36545),to(#e1431f))}"),a.push(".dl-success{white-space: nowrap;display:flex;color:#e2534d;font-size:0.16rem;align-items:center;justify-content: space-between;color:#2A292E}"),a.push(".dl-success dt{}"),a.push(".dl-success dt img{width:45px;height:45px;border-radius:45px;border:2px solid #fff;display:block}"),a.push(".dl-success dd{font-size: 0.28rem;overflow:hidden;position:relative;padding-left:8px}"),a.push(".dl-success dd p{line-height:20px}"),a.push(".dl-success dd #mobileNo{font-size: 0.32rem}"),a.push(".dl-success dd .lBtn{background:#FFC922;border-radius:0.31rem;display:block;padding:0.1rem 0.2rem;text-align:center;color:#2A292E;font-size:0.26rem;font-family:PingFangSC-Regular;}"),a.push(".dl-success dd .lBtn.btnLoginout{border: 0.02rem solid #DBDBDC;background: #fff;margin-top: 0.1rem;}"),c=b.createElement("style"),c.type="text/css",c.innerHTML=a.join(""),b.getElementsByTagName("head")[0].appendChild(c),i=function(){}},function(b,j){var l,m,n,p,q,r,s,t,u,w,x,y,z,B,A,C;b=c(b),j=e({teml:a,teml2:d,css:"",onBefore:function(){},onAfter:function(){}},j),j.attrs||[],l="px ",m=void 0,n=j.id,g=n||h("otpModule"),p=function(a,b){return isNaN(parseFloat(a))?b:parseFloat(a)},q=p(j.borderRadius||6),r=p(j.paddingLeft||8),s=p(j.paddingRight||8),t=p(j.paddingTop||15),u=p(j.paddingBottom||15),j.moduleSpm,w=j.moduleName||"",x=j.backgroundColor,y=j.backgroundColorInner,z=b.querySelector(".otpInner"),b.classList.add("otpModule"),!b.id&&b.setAttribute("id",g),b.setAttribute("title",w),m!=t&&(0>t?e(b.style,{marginTop:t+l}):e(b.style,{paddingTop:t+l})),m!=u&&(0>u?e(b.style,{marginBottom:u+l}):e(b.style,{paddingBottom:u+l})),m!=r&&(0>r?e(b.style,{marginLeft:r+l}):e(b.style,{paddingLeft:r+l})),m!=s&&(0>u?e(b.style,{marginRight:s+l}):e(b.style,{paddingRight:s+l})),x&&e(b.style,{backgroundColor:x}),z&&(q&&e(z.style,{borderRadius:q+l}),y&&e(z.style,{backgroundColor:y})),j.spm&&(b.setAttribute("data-spm",j.spm),b.setAttribute("data-spm-type","all")),i(),A=null,CY.userUtil.check_v1(function(a){if(A=a,b.innerHTML=A?j.teml2:j.teml,A){var c=b.querySelector(".btnLoginout");c.onclick=function(){spm.util.cookie.set("login_token","",{expires:-1}),location.reload()},"2"==j.showLoginout&&(c.style.display="none"),"1"==j.loginOption&&j.successUrl&&spm.refresh(j.successUrl),CY.ajaxUtil.loadData("/pointgate/web/user/points/querybytoken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:{login_token:A}}).then(function(a){if("0000"==a.respCode){a=a.data;var c=b.querySelector("#points");c&&(c.innerHTML=a.points)}}),CY.ajaxUtil.loadData("/pointgate/nmember/accountSet",{method:"POST",body:{login_token:A}}).then(function(a){var c,d,e,f;"0000"==a.respCode&&(a=a.data.data,c=a.mobileNo,d=a.imageUrl,e=b.querySelector("#mobileNo"),f=b.querySelector("#imageUrl"),c&&e&&(e.innerHTML=c.replace(/^(\d{3})(\d{4})(\d{4})$/,"$1****$3")),0!=d&&f&&(f.src="/"+d))})}else B=CY.valid.config({alertMeg:!0}),CY.valid("#mobileid").initValid({}).regType({regExp:/^1\d{10,10}$/,onError:"手机号码格式不对！"}).mark({isHolder:!0,tip:"请输入手机号码"}),CY.valid("#smsCode").initValid({}).regType({regExp:/^\d{4,4}$/,onError:"短信校验码格式不对！"}).mark({isHolder:!0,tip:"请输入短信校验码"}),CY.sendSmsUtil({phoneID:"#mobileid",btnID:"#codeBtn"}),b.querySelector("#submitBtn").onclick=function(){B.pageIsValid()&&C()};j.onBefore(j,b)}),C=function(){var a=!1,c={activityCode:spm.util.getQueryValue("activityCode"),channelSource:spm.getSource(),fingerprint:_fmOpt.getinfo(),sessionId:window.sessionId||""};return function(){a||(a=!0,B.serializeArray().forEach(function(a){c[a.name]=a.value}),CY.ajaxUtil.loadData("/pointgate/activityRegister/register",{method:"POST",body:c,headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(c){if(a=!1,"0000"!=c.respCode)return this.error(c),void 0;c=c.data,j.onAfter(c,j,b);var d=j.oldlink||"/event/2018/0423hb/old.html";/1|2/.test(j.filter)&&(/1/.test(j.filter)&&"00"==c.userFlag&&spm.refresh(d),/2/.test(j.filter)&&"N"==c.mobileFlag&&spm.refresh(f)),j.successUrl?spm.refresh(j.successUrl):location.reload()},error:function(a){var b=a.respCode,c=a.respMsg||a.msg;/18010086/.test(b)?CY.ui.dialog.alert(c):CY.ui.toast(c)}}))}}()}}(),a.CY.otpModule=i,i)});