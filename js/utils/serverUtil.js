"use strict";!function(e,t){if("undefined"!=typeof module)require("./ajaxUtil"),require("../libs/cache"),module.exports=t(e);else if(t(e),"function"==typeof define&&(define.amd||define.cmd)){var a="//"+(!/ppppoints.com/.test(document.domain)?"j.changyoyo.com":"j.ppppoints.com")+"/static/js/";requirejs.config({paths:{cache:a+"libs/cache",ajaxUtil:a+"utils/ajaxUtil"}}),define("serverUtil",["cache","ajaxUtil"],function(){return t(e)})}}(window||void 0,function(e){function t(){}if(!e.CY&&(e.CY={}),e.CY.serverUtil)return e.CY.serverUtil;var a="m.changyoyo.com"==document.domain;t.cssUrl=a?"//css.changyoyo.com":"//css.ppppoints.com",t.jsUrl=a?"//js.changyoyo.com":"//js.ppppoints.com",t.imgUrl=a?"//image.changyoyo.com":"//"+location.hostname;var n=function(e){return Object.prototype.toString.call(e).split(/\s(\w+)/)[1].toLowerCase()};return t.getCurrTime=function(t){t=t||function(){};var a,n,c,i=this;if(a=function(){return new Date(+new Date+i.__daTime)},n=function(){var e=t;return new Promise(function(a,n){t=function(t){e(t),a(t)}})},i.__isSynchTime)return t(a()),new Promise(function(e,t){e(a())});if(i.__timeCallbacks){var o=n();return i.__timeCallbacks.push(t),o}return i.__timeCallbacks=[t],c=function(){var e=a();i.__timeCallbacks.map(function(t){setTimeout(function(){t(e)},0)}),delete i.__timeCallbacks},e.CY.ajaxUtil.loadData("/pointgate/common/getServerDate",{}).then(function(e){return"0000"===e.respCode&&(i.__daTime=e.data.serverDate-+new Date,i.__isSynchTime=!0,c()),a()})},t.loadRecommend=function(t,a){var c=this;e.CY.cache.__items=e.CY.cache.__items||{},"function"===n(t.keyIds)&&(a=t.keyIds,t.keyIds=[]),"string"===n(t.keyIds)&&(t.keyIds=t.keyIds.split(","),a=a||function(){}),t.cache&&(e.CY.cache.runClear(),t.cache=Number(t.cache));for(var i,o,r=t.keyIds.length-1;r>=0;r--)if(i=t.keyIds[r],o=i+",",e.CY.cache.get(i)){if("all"===i){var s=e.CY.cache.get(i)||{};for(var l in s)s.hasOwnProperty(l)&&"[object Array]"===Object.prototype.toString.call(s[l])&&a(i,s[l])}else a(i,e.CY.cache.get(i));t.keyIds.splice(r,1)}else e.CY.cache.__items[o]?(e.CY.cache.__items[o].push(a),t.keyIds.splice(r,1)):e.CY.cache.__items[o]=[a];if(t.keyIds.length&&(!t.onSend||!1!==t.onSend.call(c,t,a))){for(var r=t.keyIds.length-1;r>=0;r--)"all"===t.keyIds[r]&&t.keyIds.splice(r,1);var d={keyId:t.keyIds.join(",")};t.login_token&&(d.login_token=t.login_token),e.CY.ajaxUtil.loadData(t.url||"/pointgate/service/position/newRecommend",{method:"POST",body:d}).then(function(a){if(t.onAfter&&t.onAfter.call(c,t,a),"0000"===a.respCode){for(var n,i,o=t.keyIds.length-1;o>=0;o--){n=t.keyIds[o],i=n+",";var r=a.data[n]||[];r.sort(function(e,t){return t.sort-e.sort}),e.CY.cache.set(n,r,t.cache),(e.CY.cache.__items[i]||[]).forEach(function(e){e(n,r)}),delete e.CY.cache.__items[i],delete a.data[n]}var s,l={};for(var d in a.data)if(a.data.hasOwnProperty(d)&&"[object Array]"===Object.prototype.toString.call(a.data[d])){s=!0;var i,n="all";i=n+",";var r=a.data[d]||[];r.sort(function(e,t){return t.sort-e.sort}),l[d]=r,e.CY.cache.__items[i].forEach(function(e){e(n,r)}),delete a.data[d]}s&&e.CY.cache.set("all",l,t.cache)}})}},e.CY.serverUtil=t,t});